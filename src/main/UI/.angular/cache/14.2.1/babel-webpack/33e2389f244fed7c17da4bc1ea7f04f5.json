{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { FormControl, FormGroup } from '@angular/forms';\nimport { HttpHeaders } from \"@angular/common/http\";\nlet AppComponent = class AppComponent {\n  constructor(httpClient, location, locationStrategy) {\n    this.httpClient = httpClient;\n    this.location = location;\n    this.locationStrategy = locationStrategy; // private baseURL:string='http://localhost:8080';\n\n    this.baseURL = this.location.path();\n    this.getUrl = this.baseURL + '/room/reservation/v1/';\n    this.postUrl = this.baseURL + '/room/reservation/v1';\n    this.welcomeMessageURL = this.baseURL + \"/resources/greetings\";\n    this.timeZoneURL = this.baseURL + \"/timezone/\";\n    this.easternTime = \"\";\n    this.mountainTime = \"\";\n    this.utcTime = \"\";\n    this.scene = 0;\n    this.loggedIn = false;\n    this.reservationDisplayToggle = 0;\n    this.reservations = [];\n    this.loginService = new FormGroup({\n      userName: new FormControl(\"\"),\n      password: new FormControl(\"\")\n    });\n  }\n\n  ngOnInit() {\n    this.roomsearch = new FormGroup({\n      checkin: new FormControl(' '),\n      checkout: new FormControl(' ')\n    }); //     this.rooms=ROOMS;\n\n    this.getWelcome().subscribe(sentence => {\n      this.sentences = sentence;\n    });\n    this.getEastern().subscribe(time => {\n      this.easternTime = time[0];\n    });\n    this.getMountain().subscribe(time => {\n      this.mountainTime = time[0];\n    });\n    this.getUTC().subscribe(time => {\n      this.utcTime = time[0];\n    });\n    const roomsearchValueChanges$ = this.roomsearch.valueChanges; // subscribe to the stream\n\n    roomsearchValueChanges$.subscribe(x => {\n      this.currentCheckInVal = x.checkin;\n      this.currentCheckOutVal = x.checkout;\n    });\n  }\n\n  setScene(n) {\n    this.scene = n;\n  }\n\n  displayUserReservations() {\n    return this.httpClient.get(this.getUrl + \"reservationlist/\" + this.user.id, {\n      responseType: 'json'\n    }).subscribe(res => {\n      let obLength = Object.keys(res).length;\n\n      if (obLength > 0) {\n        this.reservations = [];\n\n        for (let i = 0; i < Object.keys(res).length; i++) {\n          // @ts-ignore\n          let checkin = res[i]['checkin']; // @ts-ignore\n\n          let checkout = res[i]['checkout']; // @ts-ignore\n\n          let price = res[i]['roomEntity']['price']; // @ts-ignore\n\n          let roomNumber = res[i]['roomEntity']['roomNumber'];\n          let reservationInfo = new Reservation(checkin, checkout, roomNumber, price);\n          this.reservations.push(reservationInfo);\n          console.log(this.reservations);\n        }\n      }\n\n      this.reservationDisplayToggle = 1;\n    });\n  }\n\n  logAdditions(value, reservation) {\n    console.log(value.target.name);\n    console.log(value.target.checked);\n    reservation.additions.push(value.target.name);\n  }\n\n  validateLogin() {\n    let user = this.loginService.value.userName;\n    let password = this.loginService.value.password;\n    let login = new Login(user, password);\n    JSON.stringify(login);\n    this.httpClient.put(this.baseURL + \"/login/credentials\", login).subscribe(res => {\n      if (res) {\n        console.log(res);\n        this.loggedIn = true; // @ts-ignore\n\n        let rewards = parseInt(res['rewardsPoints']); // @ts-ignore\n\n        this.user = new User(res['id'], res['userName'], rewards);\n      }\n    });\n  } //\n  //temporary testing method - remove before full launch.\n\n\n  addOrSub(condition, amount) {\n    if (condition == 0) {\n      this.user.addPoints(amount);\n    } else {\n      this.user.subtractPoints(amount);\n    }\n  } //temporary testing method - remove before full launch.\n  //\n\n\n  logout() {\n    if (this.loggedIn) {\n      this.saveUserInfo();\n      this.loggedIn = false;\n      this.user = null;\n    }\n  } // User data front end\n  // id: string;\n  // userName: string;\n  // rewards: number;\n\n\n  saveUserInfo() {\n    let user = new User(this.user.id, this.user.userName, this.user.rewards);\n    JSON.stringify(user);\n    this.httpClient.put(this.baseURL + \"/login/save\", user).subscribe(res => console.log(res));\n  }\n\n  getWelcome() {\n    return this.httpClient.get(this.welcomeMessageURL, {\n      responseType: 'json'\n    });\n  }\n\n  getEastern() {\n    return this.httpClient.get(this.timeZoneURL + \"eastern\", {\n      responseType: 'json'\n    });\n  }\n\n  getMountain() {\n    return this.httpClient.get(this.timeZoneURL + \"mountain\", {\n      responseType: 'json'\n    });\n  }\n\n  getUTC() {\n    return this.httpClient.get(this.timeZoneURL + \"utc\", {\n      responseType: 'json'\n    });\n  }\n\n  onSubmit({\n    value,\n    valid\n  }) {\n    this.reservationDisplayToggle = 0;\n    this.getAll().subscribe(rooms => {\n      console.log(Object.values(rooms)[0]);\n      this.rooms = Object.values(rooms)[0];\n    });\n  }\n\n  reserveRoom(value, method, price) {\n    this.request = new ReserveRoomRequest(value, this.user.id, this.currentCheckInVal, this.currentCheckOutVal);\n    const roomPrice = parseInt(price);\n    this.createReservation(this.request);\n    console.log(roomPrice);\n    console.log(this.user.rewards);\n\n    if (method == \"money\") {\n      alert(\"Rerouting to payment information page! (Not Actual)\");\n    } else if (method == \"points\" && this.user.rewards >= roomPrice) {\n      alert(\"Paying with points!\");\n      this.user.subtractPoints(roomPrice);\n    } else {\n      alert(\"You don't have enough points, reverting to normal payment!\");\n    }\n\n    this.onSubmit(this.roomsearch);\n  }\n\n  createReservation(body) {\n    let bodyString = JSON.stringify(body); // Stringify payload\n\n    let headers = new Headers({\n      'Content-Type': 'application/json'\n    }); // ... Set content type to JSON\n    // let options = new RequestOptions({headers: headers}); // Create a request option\n\n    const options = {\n      headers: new HttpHeaders().append('key', 'value')\n    };\n    this.httpClient.post(this.postUrl, body, options).subscribe(res => console.log(res));\n  }\n  /*mapRoom(response:HttpResponse<any>): Room[]{\r\n    return response.body;\r\n  }*/\n\n\n  getAll() {\n    return this.httpClient.get(this.baseURL + '/room/reservation/v1?checkin=' + this.currentCheckInVal + '&checkout=' + this.currentCheckOutVal, {\n      responseType: 'json'\n    });\n  }\n\n};\nAppComponent = __decorate([Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.css']\n})], AppComponent);\nexport { AppComponent };\nexport class Reservation {\n  constructor(checkin, checkout, roomNumber, roomPrice) {\n    this.additions = [];\n    this.checkin = checkin;\n    this.checkout = checkout;\n    this.roomNumber = roomNumber;\n    this.roomPrice = roomPrice;\n  }\n\n}\nexport class User {\n  constructor(id, userName, rewards) {\n    this.id = id;\n    this.userName = userName;\n    this.rewards = rewards;\n  }\n\n  addPoints(points) {\n    this.rewards += points;\n  }\n\n  subtractPoints(points) {\n    this.rewards -= points;\n  }\n\n}\nexport class Login {\n  constructor(userName, password) {\n    this.userName = userName;\n    this.password = password;\n  }\n\n}\nexport class ReserveRoomRequest {\n  constructor(roomId, userId, checkin, checkout) {\n    this.roomId = roomId;\n    this.userId = userId;\n    this.checkin = checkin;\n    this.checkout = checkout;\n  }\n\n}\n/*\r\nvar ROOMS: Room[]=[\r\n  {\r\n  \"id\": \"13932123\",\r\n  \"roomNumber\" : \"409\",\r\n  \"price\" :\"20\",\r\n  \"links\" : \"\"\r\n},\r\n{\r\n  \"id\": \"139324444\",\r\n  \"roomNumber\" : \"509\",\r\n  \"price\" :\"30\",\r\n  \"links\" : \"\"\r\n},\r\n{\r\n  \"id\": \"139324888\",\r\n  \"roomNumber\" : \"609\",\r\n  \"price\" :\"40\",\r\n  \"links\" : \"\"\r\n}\r\n] */","map":null,"metadata":{},"sourceType":"module"}